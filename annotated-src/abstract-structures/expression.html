<!DOCTYPE html>

<html>
<head>
  <title>expression.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="../docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="expression-pointer.html">
                  abstract-structures/expression-pointer.js
                </a>
              
                
                <a class="source" href="expression-pointer.test.html">
                  abstract-structures/expression-pointer.test.js
                </a>
              
                
                <a class="source" href="expression.html">
                  abstract-structures/expression.js
                </a>
              
                
                <a class="source" href="expression.test.html">
                  abstract-structures/expression.test.js
                </a>
              
                
                <a class="source" href="index.html">
                  abstract-structures/index.js
                </a>
              
                
                <a class="source" href="sym.html">
                  abstract-structures/sym.js
                </a>
              
                
                <a class="source" href="sym.test.html">
                  abstract-structures/sym.test.js
                </a>
              
                
                <a class="source" href="../deduction-interface/deduction-interface-util.html">
                  deduction-interface/deduction-interface-util.js
                </a>
              
                
                <a class="source" href="../deduction-interface/deduction-interface.html">
                  deduction-interface/deduction-interface.js
                </a>
              
                
                <a class="source" href="../deduction-interface/deduction-interface.test.html">
                  deduction-interface/deduction-interface.test.js
                </a>
              
                
                <a class="source" href="../deduction-interface/index.html">
                  deduction-interface/index.js
                </a>
              
                
                <a class="source" href="../deduction-interface/rules-interface/biconditional-elimination-rule-interface.html">
                  deduction-interface/rules-interface/biconditional-elimination-rule-interface.js
                </a>
              
                
                <a class="source" href="../deduction-interface/rules-interface/biconditional-introduction-rule-interface.html">
                  deduction-interface/rules-interface/biconditional-introduction-rule-interface.js
                </a>
              
                
                <a class="source" href="../deduction-interface/rules-interface/conditional-elimination-rule-interface.html">
                  deduction-interface/rules-interface/conditional-elimination-rule-interface.js
                </a>
              
                
                <a class="source" href="../deduction-interface/rules-interface/conditional-introduction-rule-interface.html">
                  deduction-interface/rules-interface/conditional-introduction-rule-interface.js
                </a>
              
                
                <a class="source" href="../deduction-interface/rules-interface/conjunction-elimination-rule-interface.html">
                  deduction-interface/rules-interface/conjunction-elimination-rule-interface.js
                </a>
              
                
                <a class="source" href="../deduction-interface/rules-interface/conjunction-introduction-rule-interface.html">
                  deduction-interface/rules-interface/conjunction-introduction-rule-interface.js
                </a>
              
                
                <a class="source" href="../deduction-interface/rules-interface/disjunction-elimination-rule-interface.html">
                  deduction-interface/rules-interface/disjunction-elimination-rule-interface.js
                </a>
              
                
                <a class="source" href="../deduction-interface/rules-interface/disjunction-introduction-rule-interface.html">
                  deduction-interface/rules-interface/disjunction-introduction-rule-interface.js
                </a>
              
                
                <a class="source" href="../deduction-interface/rules-interface/explosion-rule-interface.html">
                  deduction-interface/rules-interface/explosion-rule-interface.js
                </a>
              
                
                <a class="source" href="../deduction-interface/rules-interface/index.html">
                  deduction-interface/rules-interface/index.js
                </a>
              
                
                <a class="source" href="../deduction-interface/rules-interface/negation-elimination-rule-interface.html">
                  deduction-interface/rules-interface/negation-elimination-rule-interface.js
                </a>
              
                
                <a class="source" href="../deduction-interface/rules-interface/negation-introduction-rule-interface.html">
                  deduction-interface/rules-interface/negation-introduction-rule-interface.js
                </a>
              
                
                <a class="source" href="../deduction-interface/rules-interface/premise-rule-interface.html">
                  deduction-interface/rules-interface/premise-rule-interface.js
                </a>
              
                
                <a class="source" href="../deduction-interface/rules-interface/quantification/existential-generalization-rule-interface.html">
                  deduction-interface/rules-interface/quantification/existential-generalization-rule-interface.js
                </a>
              
                
                <a class="source" href="../deduction-interface/rules-interface/quantification/existential-instantiation-rule-interface.html">
                  deduction-interface/rules-interface/quantification/existential-instantiation-rule-interface.js
                </a>
              
                
                <a class="source" href="../deduction-interface/rules-interface/quantification/generalization-rule-interface.html">
                  deduction-interface/rules-interface/quantification/generalization-rule-interface.js
                </a>
              
                
                <a class="source" href="../deduction-interface/rules-interface/quantification/index.html">
                  deduction-interface/rules-interface/quantification/index.js
                </a>
              
                
                <a class="source" href="../deduction-interface/rules-interface/quantification/instantiation-rule-interface.html">
                  deduction-interface/rules-interface/quantification/instantiation-rule-interface.js
                </a>
              
                
                <a class="source" href="../deduction-interface/rules-interface/quantification/quantification-rule-interface.html">
                  deduction-interface/rules-interface/quantification/quantification-rule-interface.js
                </a>
              
                
                <a class="source" href="../deduction-interface/rules-interface/quantification/universal-generalization-rule-interface.html">
                  deduction-interface/rules-interface/quantification/universal-generalization-rule-interface.js
                </a>
              
                
                <a class="source" href="../deduction-interface/rules-interface/quantification/universal-instantiation-rule-interface.html">
                  deduction-interface/rules-interface/quantification/universal-instantiation-rule-interface.js
                </a>
              
                
                <a class="source" href="../deduction-interface/rules-interface/rules-interface.html">
                  deduction-interface/rules-interface/rules-interface.js
                </a>
              
                
                <a class="source" href="../deduction-interface/rules-interface/tautological-implication-rule-interface.html">
                  deduction-interface/rules-interface/tautological-implication-rule-interface.js
                </a>
              
                
                <a class="source" href="../deduction-interface/rules-interface/theorem-rule-interface.html">
                  deduction-interface/rules-interface/theorem-rule-interface.js
                </a>
              
                
                <a class="source" href="../deduction-interface/tests/biconditional-elimination.test.html">
                  deduction-interface/tests/biconditional-elimination.test.js
                </a>
              
                
                <a class="source" href="../deduction-interface/tests/biconditional-introduction.test.html">
                  deduction-interface/tests/biconditional-introduction.test.js
                </a>
              
                
                <a class="source" href="../deduction-interface/tests/conditional-elimination.test.html">
                  deduction-interface/tests/conditional-elimination.test.js
                </a>
              
                
                <a class="source" href="../deduction-interface/tests/conditional-introduction.test.html">
                  deduction-interface/tests/conditional-introduction.test.js
                </a>
              
                
                <a class="source" href="../deduction-interface/tests/conjunction-elimination.test.html">
                  deduction-interface/tests/conjunction-elimination.test.js
                </a>
              
                
                <a class="source" href="../deduction-interface/tests/conjunction-introduction.test.html">
                  deduction-interface/tests/conjunction-introduction.test.js
                </a>
              
                
                <a class="source" href="../deduction-interface/tests/disjunction-elimination.test.html">
                  deduction-interface/tests/disjunction-elimination.test.js
                </a>
              
                
                <a class="source" href="../deduction-interface/tests/disjunction-introduction.test.html">
                  deduction-interface/tests/disjunction-introduction.test.js
                </a>
              
                
                <a class="source" href="../deduction-interface/tests/existential-generalization.test.html">
                  deduction-interface/tests/existential-generalization.test.js
                </a>
              
                
                <a class="source" href="../deduction-interface/tests/existential-instantiation.test.html">
                  deduction-interface/tests/existential-instantiation.test.js
                </a>
              
                
                <a class="source" href="../deduction-interface/tests/explosion.test.html">
                  deduction-interface/tests/explosion.test.js
                </a>
              
                
                <a class="source" href="../deduction-interface/tests/negation-elimination.test.html">
                  deduction-interface/tests/negation-elimination.test.js
                </a>
              
                
                <a class="source" href="../deduction-interface/tests/negation-introduction.test.html">
                  deduction-interface/tests/negation-introduction.test.js
                </a>
              
                
                <a class="source" href="../deduction-interface/tests/premise.test.html">
                  deduction-interface/tests/premise.test.js
                </a>
              
                
                <a class="source" href="../deduction-interface/tests/tautological-implication.test.html">
                  deduction-interface/tests/tautological-implication.test.js
                </a>
              
                
                <a class="source" href="../deduction-interface/tests/universal-generalization.test.html">
                  deduction-interface/tests/universal-generalization.test.js
                </a>
              
                
                <a class="source" href="../deduction-interface/tests/universal-instantiation.test.html">
                  deduction-interface/tests/universal-instantiation.test.js
                </a>
              
                
                <a class="source" href="../deduction-structure/deduction.html">
                  deduction-structure/deduction.js
                </a>
              
                
                <a class="source" href="../deduction-structure/index.html">
                  deduction-structure/index.js
                </a>
              
                
                <a class="source" href="../deduction-structure/rule-application-spec/index.html">
                  deduction-structure/rule-application-spec/index.js
                </a>
              
                
                <a class="source" href="../deduction-structure/rule-application-spec/regular-rule-application-spec.html">
                  deduction-structure/rule-application-spec/regular-rule-application-spec.js
                </a>
              
                
                <a class="source" href="../deduction-structure/rule-application-spec/theorem-rule-application-spec.html">
                  deduction-structure/rule-application-spec/theorem-rule-application-spec.js
                </a>
              
                
                <a class="source" href="../deduction-structure/rule.html">
                  deduction-structure/rule.js
                </a>
              
                
                <a class="source" href="../deduction-structure/step.html">
                  deduction-structure/step.js
                </a>
              
                
                <a class="source" href="../deduction-structure/term-dependency-graph/index.html">
                  deduction-structure/term-dependency-graph/index.js
                </a>
              
                
                <a class="source" href="../deduction-structure/term-dependency-graph/term-dependency-graph.html">
                  deduction-structure/term-dependency-graph/term-dependency-graph.js
                </a>
              
                
                <a class="source" href="../deduction-structure/term-dependency-graph/term-dependency-graph.test.html">
                  deduction-structure/term-dependency-graph/term-dependency-graph.test.js
                </a>
              
                
                <a class="source" href="../deduction-util/deduction-deflated.html">
                  deduction-util/deduction-deflated.js
                </a>
              
                
                <a class="source" href="../deduction-util/deduction-inflate-deflate.html">
                  deduction-util/deduction-inflate-deflate.js
                </a>
              
                
                <a class="source" href="../deduction-util/deduction-inflate-deflate.test.html">
                  deduction-util/deduction-inflate-deflate.test.js
                </a>
              
                
                <a class="source" href="../deduction-util/index.html">
                  deduction-util/index.js
                </a>
              
                
                <a class="source" href="../error.html">
                  error.js
                </a>
              
                
                <a class="source" href="../formula-construction-util.html">
                  formula-construction-util.js
                </a>
              
                
                <a class="source" href="../formula-construction-util.test.html">
                  formula-construction-util.test.js
                </a>
              
                
                <a class="source" href="../index.html">
                  index.js
                </a>
              
                
                <a class="source" href="../jest.setup.html">
                  jest.setup.js
                </a>
              
                
                <a class="source" href="../parsers/deduction-parser/ast-processor.html">
                  parsers/deduction-parser/ast-processor.js
                </a>
              
                
                <a class="source" href="../parsers/deduction-parser/deduction-parser.html">
                  parsers/deduction-parser/deduction-parser.js
                </a>
              
                
                <a class="source" href="../parsers/deduction-parser/deduction-parser.test.html">
                  parsers/deduction-parser/deduction-parser.test.js
                </a>
              
                
                <a class="source" href="../parsers/deduction-parser/index.html">
                  parsers/deduction-parser/index.js
                </a>
              
                
                <a class="source" href="../parsers/formula-parser/ast-processor.html">
                  parsers/formula-parser/ast-processor.js
                </a>
              
                
                <a class="source" href="../parsers/formula-parser/formula-parser.html">
                  parsers/formula-parser/formula-parser.js
                </a>
              
                
                <a class="source" href="../parsers/formula-parser/formula-parser.test.html">
                  parsers/formula-parser/formula-parser.test.js
                </a>
              
                
                <a class="source" href="../parsers/formula-parser/index.html">
                  parsers/formula-parser/index.js
                </a>
              
                
                <a class="source" href="../parsers/index.html">
                  parsers/index.js
                </a>
              
                
                <a class="source" href="../parsers/peg/ast-formula.html">
                  parsers/peg/ast-formula.js
                </a>
              
                
                <a class="source" href="../parsers/peg/grammar.html">
                  parsers/peg/grammar.js
                </a>
              
                
                <a class="source" href="../parsers/peg/index.html">
                  parsers/peg/index.js
                </a>
              
                
                <a class="source" href="../parsers/peg/parser-deduction.test.html">
                  parsers/peg/parser-deduction.test.js
                </a>
              
                
                <a class="source" href="../parsers/peg/parser-formula.test.html">
                  parsers/peg/parser-formula.test.js
                </a>
              
                
                <a class="source" href="../parsers/validators.html">
                  parsers/validators.js
                </a>
              
                
                <a class="source" href="../presentation/sym-presentation/index.html">
                  presentation/sym-presentation/index.js
                </a>
              
                
                <a class="source" href="../presentation/sym-presentation/presentations.html">
                  presentation/sym-presentation/presentations.js
                </a>
              
                
                <a class="source" href="../presentation/sym-presentation/primitive-presentations.html">
                  presentation/sym-presentation/primitive-presentations.js
                </a>
              
                
                <a class="source" href="../presentation/sym-presentation/sym-presentation.html">
                  presentation/sym-presentation/sym-presentation.js
                </a>
              
                
                <a class="source" href="../primitive-syms.html">
                  primitive-syms.js
                </a>
              
                
                <a class="source" href="../propositional-logic/index.html">
                  propositional-logic/index.js
                </a>
              
                
                <a class="source" href="../propositional-logic/primitive-truth-functions.html">
                  propositional-logic/primitive-truth-functions.js
                </a>
              
                
                <a class="source" href="../propositional-logic/propositional-logic-util.html">
                  propositional-logic/propositional-logic-util.js
                </a>
              
                
                <a class="source" href="../propositional-logic/propositional-logic-util.test.html">
                  propositional-logic/propositional-logic-util.test.js
                </a>
              
                
                <a class="source" href="../propositional-logic/propositional-logic.html">
                  propositional-logic/propositional-logic.js
                </a>
              
                
                <a class="source" href="../propositional-logic/propositional-logic.test.html">
                  propositional-logic/propositional-logic.test.js
                </a>
              
                
                <a class="source" href="../propositional-logic/reduce-to-truth-functional.html">
                  propositional-logic/reduce-to-truth-functional.js
                </a>
              
                
                <a class="source" href="../utils.html">
                  utils.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>expression.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">import</span> _ <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;lodash&#x27;</span>
<span class="hljs-keyword">import</span> { createError, ErrorName } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../error&#x27;</span>
<span class="hljs-keyword">import</span> { Base } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../utils&#x27;</span>
<span class="hljs-keyword">import</span> { Kind } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./sym&#x27;</span>
<span class="hljs-keyword">import</span> stampit <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@stamp/it&#x27;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Expression is a recursive tree structure built from symbols. It represents formulas and terms.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> Expression = stampit({
  <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Expression&#x27;</span>,
  <span class="hljs-attr">statics</span>: {</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Reduces <code>expressions</code> to a single expression using binary connective. Reduction is performed
from left to right. For example: From <code>A, B, C</code> we get <code>((A, B), C)</code>, not <code>(A, (B, C))</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    connectWithBinarySym (expressions, sym) {
      <span class="hljs-keyword">if</span> (expressions.length &lt; <span class="hljs-number">2</span>) <span class="hljs-keyword">throw</span> createError(ErrorName.NOT_ENOUGH_EXPRESSIONS)
      <span class="hljs-keyword">const</span> [first, second, ...rest] = expressions

      <span class="hljs-keyword">const</span> connect = <span class="hljs-function">(<span class="hljs-params">first, second</span>) =&gt;</span> Expression({ sym, <span class="hljs-attr">children</span>: [first, second] })

      <span class="hljs-keyword">return</span> rest.reduce(connect, connect(first, second))
    }
  },
  init ({</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Main symbol of this expression.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    sym,</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Optional bound symbol which will exist if <code>sym</code>‘s <code>binds</code> is true. In first-order logic
<code>boundSym</code> will always be a nullary term symbol (individual variable), but here we are at a
higher level of abstraction and are not concerned about this.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    boundSym,</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Array of subexpressions whose length will match <code>sym</code>‘s arity and their kinds will match
<code>sym</code>‘s <code>argumentKind</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    children = []
  }) {
    <span class="hljs-built_in">this</span>.sym = sym
    <span class="hljs-built_in">this</span>.boundSym = boundSym
    <span class="hljs-built_in">this</span>.children = children
  },
  <span class="hljs-attr">methods</span>: {</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Returns the child subexpression at the index <code>i</code> or throws an error.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    getChild (i) {
      <span class="hljs-keyword">const</span> child = <span class="hljs-built_in">this</span>.children[i]
      <span class="hljs-keyword">if</span> (child === <span class="hljs-literal">undefined</span>) {
        <span class="hljs-keyword">throw</span> createError(ErrorName.NO_CHILD_AT_INDEX, <span class="hljs-literal">undefined</span>, { <span class="hljs-attr">expression</span>: <span class="hljs-built_in">this</span>, i })
      }
      <span class="hljs-keyword">return</span> child
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Returns the subexpression at the <code>position</code> where <code>position</code> is an array of indexes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    getSubexpression (position) {
      <span class="hljs-keyword">if</span> (position.length === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>
      <span class="hljs-keyword">const</span> [firstIndex, ...restIndexes] = position
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.getChild(firstIndex).getSubexpression(restIndexes)
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Replaces subexpression at the <code>position</code> with a <code>newSubexpression</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    replaceSubexpression (position, newSubexpression) {
      <span class="hljs-keyword">if</span> (position.length === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> newSubexpression

      <span class="hljs-keyword">const</span> [firstIndex, ...restIndexes] = position

      <span class="hljs-keyword">const</span> children = [
        ...this.children.slice(<span class="hljs-number">0</span>, firstIndex),
        <span class="hljs-built_in">this</span>.children[firstIndex].replaceSubexpression(restIndexes, newSubexpression),
        ...this.children.slice(firstIndex + <span class="hljs-number">1</span>)
      ]

      <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.clone({ children })
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Replaces subexpression at the <code>position</code> with the result of calling <code>update</code>. <code>update</code>
receives existing subexpression as an argument.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    updateSubexpression (position, update) {
      <span class="hljs-keyword">const</span> newSubexpression = update(<span class="hljs-built_in">this</span>.getSubexpression(position))
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.replaceSubexpression(position, newSubexpression)
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Returns an array of subexpressions on path <code>position</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    getSubexpressionsOnPath (position) {
      <span class="hljs-keyword">const</span> result = [<span class="hljs-built_in">this</span>]

      <span class="hljs-keyword">if</span> (position.length &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">const</span> [firstIndex, ...restIndexes] = position
        result.push(...this.getChild(firstIndex).getSubexpressionsOnPath(restIndexes))
      }

      <span class="hljs-keyword">return</span> result
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Replaces main symbol at <code>position</code> with <code>newSym</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    replaceSymAt (
      position,
      newSym,</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Called if <code>newSym</code> binds, but old one doesn’t. <code>getBoundSym</code> must produce new symbol to
bind.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      getBoundSym,</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Called if <code>newSym</code> has a larger arity than old one. <code>getChild</code> must produce new children to
be added.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      getChild
    ) {
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.updateSubexpression(position, <span class="hljs-function"><span class="hljs-params">subexpression</span> =&gt;</span> {
        <span class="hljs-keyword">const</span> {
          sym,
          boundSym,
          children
        } = subexpression

        <span class="hljs-keyword">const</span> newBoundSym = newSym.binds ? boundSym ?? getBoundSym?.() : <span class="hljs-literal">undefined</span>
        <span class="hljs-keyword">const</span> newChildren = resolveChildren(sym, newSym, children, getChild)

        <span class="hljs-keyword">return</span> subexpression.clone({
          <span class="hljs-attr">sym</span>: newSym,
          <span class="hljs-attr">boundSym</span>: newBoundSym,
          <span class="hljs-attr">children</span>: newChildren
        })
      })
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Returns an array of positions where <code>sym</code> occurs as free.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    findFreeOccurrences (sym) {
      <span class="hljs-keyword">const</span> result = []

      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.sym.id === sym.id) result.push([])

      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.boundSym?.id !== sym.id) {
        <span class="hljs-built_in">this</span>.children.forEach(<span class="hljs-function">(<span class="hljs-params">child, i</span>) =&gt;</span> {
          child
            .findFreeOccurrences(sym)
            .forEach(<span class="hljs-function"><span class="hljs-params">position</span> =&gt;</span> { result.push([i, ...position]) })
        })
      }

      <span class="hljs-keyword">return</span> result
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Returns a list of positions of bound occurrences of <code>boundSym</code>. Throws an error if <code>boundSym</code>
doesn’t exist.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    findBoundOccurrences () {
      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.boundSym === <span class="hljs-literal">undefined</span>) {
        <span class="hljs-keyword">throw</span> createError(ErrorName.EXPRESSION_DOESNT_BIND, <span class="hljs-literal">undefined</span>, <span class="hljs-built_in">this</span>)
      }

      <span class="hljs-keyword">return</span> _.flatMap(
        <span class="hljs-built_in">this</span>.children,
        <span class="hljs-function">(<span class="hljs-params">child, i</span>) =&gt;</span>
          child
            .findFreeOccurrences(<span class="hljs-built_in">this</span>.boundSym)
            .map(<span class="hljs-function"><span class="hljs-params">childResult</span> =&gt;</span> [i, ...childResult])
      )
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Replaces free occurrences of <code>sym</code> with <code>newSym</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    replaceFreeOccurrences: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">
      sym,
      newSym,
</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Called if <code>newSym</code> binds, but old one doesn’t.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      getBoundSym,</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Called if <code>newSym</code> has a larger arity than old one.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      getChild
    ) {
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>
        .findFreeOccurrences(sym)
        .reduce(
          <span class="hljs-function">(<span class="hljs-params">expression, position</span>) =&gt;</span>
            expression.replaceSymAt(
              position,
              newSym,
              getBoundSym === <span class="hljs-literal">undefined</span> ? <span class="hljs-literal">undefined</span> : <span class="hljs-function">() =&gt;</span> getBoundSym(position),
              getChild === <span class="hljs-literal">undefined</span> ? <span class="hljs-literal">undefined</span> : <span class="hljs-function">() =&gt;</span> getChild(position)
            ),
          <span class="hljs-built_in">this</span>
        )
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Replaces bound occurrences of <code>boundSym</code> with <code>newSym</code>. Also replaces <code>boundSym</code> property
in root expression.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    replaceBoundOccurrences (newSym) {
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.clone({
        ...this
          .findBoundOccurrences()
          .reduce(<span class="hljs-function">(<span class="hljs-params">expression, position</span>) =&gt;</span> expression.replaceSymAt(position, newSym), <span class="hljs-built_in">this</span>),
        <span class="hljs-attr">boundSym</span>: newSym
      })
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Finds subexpression at <code>position</code> and replaces all bound occurrences of its <code>boundSym</code> with
<code>newSym</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    replaceBoundOccurrencesAt (position, newSym) {
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.updateSubexpression(
        position,
        <span class="hljs-function"><span class="hljs-params">subexpression</span> =&gt;</span> subexpression.replaceBoundOccurrences(newSym)
      )
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Returns all symbols in an <code>expression</code> (both main and bound symbols). Result is an object
which contains symbols mapped by their ids.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    getSyms () {
      <span class="hljs-keyword">const</span> result = {}
      result[<span class="hljs-built_in">this</span>.sym.id] = <span class="hljs-built_in">this</span>.sym

      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.boundSym !== <span class="hljs-literal">undefined</span>) {
        result[<span class="hljs-built_in">this</span>.boundSym.id] = <span class="hljs-built_in">this</span>.boundSym
      }

      <span class="hljs-built_in">this</span>.children.forEach(<span class="hljs-function"><span class="hljs-params">child</span> =&gt;</span> { <span class="hljs-built_in">Object</span>.assign(result, child.getSyms()) })

      <span class="hljs-keyword">return</span> result
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Returns free symbols. <code>boundSyms</code> contains additional symbols which are to be considered as
bound. These symbols are omitted from the result. <code>boundSyms</code> primarily exists for passing
data in recursive calls.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    getFreeSyms (boundSyms = {}) {
      <span class="hljs-keyword">const</span> result = {}

      <span class="hljs-keyword">if</span> (boundSyms[<span class="hljs-built_in">this</span>.sym.id] === <span class="hljs-literal">undefined</span>) {
        result[<span class="hljs-built_in">this</span>.sym.id] = <span class="hljs-built_in">this</span>.sym
      }

      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.boundSym !== <span class="hljs-literal">undefined</span>) {
        boundSyms = {
          ...boundSyms,
          [<span class="hljs-built_in">this</span>.boundSym.id]: <span class="hljs-built_in">this</span>.boundSym
        }
      }

      <span class="hljs-built_in">this</span>.children.forEach(<span class="hljs-function"><span class="hljs-params">child</span> =&gt;</span> { <span class="hljs-built_in">Object</span>.assign(result, child.getFreeSyms(boundSyms)) })

      <span class="hljs-keyword">return</span> result
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Returns free symbols of the kind <code>Term</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    getFreeTerms (boundSyms = {}) {
      <span class="hljs-keyword">return</span> _.pickBy(
        <span class="hljs-built_in">this</span>.getFreeSyms(boundSyms),
        <span class="hljs-function"><span class="hljs-params">sym</span> =&gt;</span> sym.kind === Kind.Term
      )
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Finds all <code>boundSym</code>s which occur on the paths to free occurrences of <code>sym</code>. In other words
it looks for all symbols which are bound by subexpressions where <code>sym</code> appears as free.
<code>boundSyms</code> are additional symbols which will be added to the result. <code>boundSyms</code> exists
primarily for passing data in recursive calls.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    findBoundSymsAtFreeOccurrencesOfSym (sym, boundSyms = {}) {
      <span class="hljs-keyword">let</span> result = {}

      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.sym.id === sym.id) result = boundSyms

      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.boundSym !== <span class="hljs-literal">undefined</span>) {
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.boundSym.id === sym.id) <span class="hljs-keyword">return</span> result
        boundSyms[<span class="hljs-built_in">this</span>.boundSym.id] = <span class="hljs-built_in">this</span>.boundSym
      }

      <span class="hljs-built_in">this</span>.children.forEach(<span class="hljs-function"><span class="hljs-params">child</span> =&gt;</span> {
        <span class="hljs-built_in">Object</span>.assign(result, child.findBoundSymsAtFreeOccurrencesOfSym(sym, boundSyms))
      })

      <span class="hljs-keyword">return</span> result
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Returns isomorphic expression with lowest possible symbol ids and a map with performed symbol
substitutions. <code>syms</code> is a set of symbols which won’t be changed (it can also be considered
as initial map of substitutions where all substitutions are redundant i.e. substitute is the
same as the symbol being substituted).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    normalize (syms = {}) {
      <span class="hljs-keyword">let</span> mainSymSubstitute = syms[<span class="hljs-built_in">this</span>.sym.id]

      <span class="hljs-keyword">if</span> (mainSymSubstitute === <span class="hljs-literal">undefined</span>) {
        <span class="hljs-keyword">const</span> newMainSymId = getNextSymId(syms)
        mainSymSubstitute = <span class="hljs-built_in">this</span>.sym.clone({ <span class="hljs-attr">id</span>: newMainSymId })
        syms = {
          ...syms,
          [<span class="hljs-built_in">this</span>.sym.id]: mainSymSubstitute
        }
      }

      <span class="hljs-keyword">let</span> boundSymSubstitute
      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.boundSym !== <span class="hljs-literal">undefined</span>) {
        <span class="hljs-keyword">const</span> newBoundSymId = getNextSymId(syms)
        boundSymSubstitute = <span class="hljs-built_in">this</span>.boundSym.clone({ <span class="hljs-attr">id</span>: newBoundSymId })
        syms = {
          ...syms,
          [<span class="hljs-built_in">this</span>.boundSym.id]: boundSymSubstitute
        }
      }

      <span class="hljs-keyword">const</span> childrenSubstitute = []
      <span class="hljs-built_in">this</span>.children.forEach(<span class="hljs-function"><span class="hljs-params">child</span> =&gt;</span> {
        <span class="hljs-keyword">const</span> [childSubstitute, newSyms] = child.normalize(syms)
        childrenSubstitute.push(childSubstitute)
        syms = newSyms
      })

      <span class="hljs-keyword">return</span> [
        <span class="hljs-built_in">this</span>.clone({
          <span class="hljs-attr">sym</span>: mainSymSubstitute,
          <span class="hljs-attr">boundSym</span>: boundSymSubstitute,
          <span class="hljs-attr">children</span>: childrenSubstitute
        }),
        <span class="hljs-built_in">this</span>.boundSym !== <span class="hljs-literal">undefined</span> ? _.omit(syms, [<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-built_in">this</span>.boundSym.id}</span>`</span>]) : syms
      ]
    }
  }
}).compose(Base)

<span class="hljs-keyword">const</span> resolveChildren = <span class="hljs-function">(<span class="hljs-params">oldSym, newSym, oldChildren, getChild</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (oldSym.argumentKind !== newSym.argumentKind) {
    <span class="hljs-keyword">if</span> (getChild === <span class="hljs-literal">undefined</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&#x27;getChild not present&#x27;</span>)
    <span class="hljs-keyword">return</span> _.range(<span class="hljs-number">0</span>, newSym.arity).map(getChild)
  }

  <span class="hljs-keyword">if</span> (oldChildren.length &gt;= newSym.arity) {
    <span class="hljs-keyword">return</span> oldChildren.slice(<span class="hljs-number">0</span>, newSym.arity)
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">if</span> (getChild === <span class="hljs-literal">undefined</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&#x27;getChild not present&#x27;</span>)
    <span class="hljs-keyword">return</span> oldChildren.concat(_.range(oldChildren.length, newSym.arity).map(getChild))
  }
}</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Returns next free id not occurring in <code>syms</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> getNextSymId = <span class="hljs-function"><span class="hljs-params">syms</span> =&gt;</span>
  _.isEmpty(syms)
    ? <span class="hljs-number">0</span>
    : <span class="hljs-built_in">Math</span>.max(..._.values(syms).map(<span class="hljs-function">(<span class="hljs-params">{ id }</span>) =&gt;</span> id)) + <span class="hljs-number">1</span></pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
